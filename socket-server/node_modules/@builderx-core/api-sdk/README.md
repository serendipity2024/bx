# @builderx-core/api-sdk

This project was bootstrapped with [TSDX].

APISDK is a Backend Communication layer for BuilderX.

## Features

- **Init** - Used for Authentication
- **Projects** - Get, Post, Update, Clone, Shareability
- **Files** - Get, Delete, Patch, Exists
- **ProjectLog** - Post
- **FileContent** - Get, Post
- **User** - Get, Patch
- **Teams** - Get
- **Poll** - Connect
- **Raw** - getBlob, checkPort
- **Assets** - getFont, getCloudImage, getGoogleFonts, fetchLocalFonts, uploadAsset

### Installation

To install ApiSdk in your project, first you need to be a member of builderx-core team. After then you have to login into your npm account by running command:

```ts
npm login
```

When prompted, provide your SSO credentials and after that you can install ApiSdk by running this command in the root directory of your project:

```ts
yarn add @builderx-core/api-sdk
```

### Usage

```ts
import APISDK from "@builderx-core/api-sdk";

APISDK.init({
  env: "{local|pre-cloud|production}",
  baseUrl: "www.localhost:3000.com",
});

try {
  const response = await APISDK.project.get(projectId, connectionId);
} catch (err) {
  throw err;
}

try {
  const response = await APISDK.project.update(projectId, newName);
} catch (err) {
  throw err;
}
```

**Note** : Initialize the module by calling Init (needs to be done before calling any function)

### Development

Open your Terminal and run this commands in the root directory of project.

Start:

```ts
$ yarn && yarn start
```

After that navigate to the \$PROJECT_DIR/example directory and run command :-

```ts
$ yarn && yarn start
```

Now you can start development and debug errors while coding.

### Config Setup

Navigate to \$PROJECT_DIR/src/config.ts and set the default config:

Config:

```ts
{
  env: "local",
  baseUrl: "https://pre-cloud.builderx.io/api/",
  accessToken: jsCookie.get("access-token"),
  googleFontsUrl: "https://www.googleapis.com/webfonts/v1/webfonts?key=",
  localFontsUrl: "http://localhost:8979",
};
```

Default config can be overriden by calling **init** method.

### Contribution guidelines

Want to contribute? Great!

Please read the following guidelines carefully when contributing:

- Pull request limit : 50 - 100 lines
- New Feature : Use branch name 'feat/\<featurename\>'
- Fix : Use branch name 'fix/\<featurename\>'

### How to Publish?

Please read the following guidelines carefully while publishing:

#### Step 1 :-

Before building a production build, run this command at the root of your project folder:

```ts
$ yarn test
```

If all the test cases are passed then make a production build by running his command at the root of your project folder:

```ts
$ yarn build
```

#### Step 2 :-

For a better publish use [np]. To install [np] globally run command :-

```ts
$ yarn global add np
```

After installing np, navigate to the root directory of your project folder and run command :-

```ts
$ np
```

#### Step 3 :-

We have enabled 2 step verification for better security. So before publishing a prompt will be displayed asking for the otp.

Contact Himanshu Satija (himanshu@builderx.io) for further steps.

Otp can be obtained by installing [Google Authenticator]. It doesnâ€™t require any internet or mobile connection. The system generates the secret key - a unique 16 or 32 character alphanumeric code. This code is scanned by GA or can be entered manually and as a result, both system and GA know the same secret key. Based on it they generate the same OTPs.

### Test Cases

ApiSdk has a setup of test cases for different end points. To achieve the goal of having a proper response structure, every incoming response is passed to a number of equality checks. For eg:

```ts
it("ApiSdk user get response", async () => {
  try {
    const response = await ApiSdk.user.get(testConfig.userId);
    checkResponseStructure(response);
    checkUser(response.data);
  } catch (err) {
    throw new Error(`Error in user get response ${err}`);
  }
});

const checkResponseStructure = (response: APIResponse<any>) => {

  expect(response).toEqual({
    data: expect.any(Object),
    status: expect.any(Number),
    message: expect.any(String),
    headers: expect.any(Object),
  });
};

const checkUser = (data: User) => {
  expect(data).toMatchObject({
    id: expect.any(Number),
    email: expect.any(String),
    name: expect.any(String),
    created_at: expect.any(String),
    updated_at: expect.any(String),
    google_id: expect.any(String),
    active: expect.any(Number),
    config: expect.any(String),
    photo_url: expect.any(String),
    uses_two_factor_auth: expect.any(Boolean),
    current_team_id: expect.any(Number),
    avatar: expect.any(String),
    avatar_original: expect.any(String),
    last_logged_in: expect.any(String),
    newsletter_unsubscribe: expect.any(Number),
    updates_unsubscribe: expect.any(Number),
    disable: expect.any(Number),
    version: expect.any(Number),
    tax_rate: expect.any(Number),
  });
};
```

### Tech

APISDK uses only two open source projects to work properly:

- [axios] - Promise based HTTP client for the browser and node.js
- [js-cookie] - A simple, lightweight JavaScript API for handling cookies

### Maintainers List

- Anurag Garg (anurag@builderx.io)
- Himanshu Satija (himanshu@builderx.io)

[tsdx]: https://github.com/jaredpalmer/tsdx
[axios]: https://github.com/axios/axios
[js-cookie]: https://github.com/js-cookie/js-cookie
[np]: https://github.com/sindresorhus/np
[google authenticator]: https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2
