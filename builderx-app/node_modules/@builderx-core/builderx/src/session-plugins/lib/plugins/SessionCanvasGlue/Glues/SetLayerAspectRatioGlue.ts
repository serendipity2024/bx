import { SessionEvent } from "event-manager";
import { Session } from "session";
import { DomainLayer } from "domain-x";
import { forEach } from "lodash";
import { Layer } from "@builderx-core/designer";
import { globalRefMap } from "global-ref-map";

export function applySideEffects(
  session: Session,
  layer: DomainLayer,
  value: number | undefined
) {
  const domainCompiledLayers = globalRefMap.get(layer);
  if (domainCompiledLayers) {
    forEach(domainCompiledLayers, (compiledLayer: Layer) => {
      compiledLayer.setAspectRatio(value);
    });
  }
}

export default function SetLayerAspectRatioGlue(
  session: Session,
  e: SessionEvent
) {
  applySideEffects(session, e.payload.layer, e.payload.value);
}
