import * as React from "react";
import { Session } from "session";
import StackedAvatar from "./StackedAvatarComponent";
import { OnlineUserCollection } from "./../model";

export default class AvatarComponentWrapper extends React.PureComponent<
  { session: Session; userCollection: OnlineUserCollection },
  {}
> {
  onUpdate = (keys: any) => {
    this.forceUpdate();
  };
  componentDidMount() {
    this.props.userCollection.on("users", this.onUpdate);
  }
  componentWillUnmount() {
    this.props.userCollection.off("users", this.onUpdate);
  }
  render() {
    let avatarMap = new Map();
    this.props.userCollection.users.forEach(user => {
      let userAvatarArray: any = avatarMap.get(user.id);
      if (!userAvatarArray) {
        userAvatarArray = [];
      }
      userAvatarArray.push(user);
      avatarMap.set(user.id, userAvatarArray);
    });
    return (
      <StackedAvatar
        style={{ paddingRight: 10 }}
        avatarMap={avatarMap}
        maxAvatars={4}
        uiSize="s"
      />
    );
  }
}
