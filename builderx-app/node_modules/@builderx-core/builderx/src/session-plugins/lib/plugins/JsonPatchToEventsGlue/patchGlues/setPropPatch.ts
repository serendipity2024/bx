import { DomainLayer, DomainFile } from "domain-x";
import { Session } from "session";
import { SessionEvent } from "event-manager";
import { get } from "lodash";

export default function setPropPatch(
  session: Session,
  operationPath: string,
  layer: DomainFile | DomainLayer,
  operation: any
) {
  // TODO: if prop is style, do we need to handle that separately?
  const args = operationPath.split("/");

  const key = args[args.length - 1];

  // if (key === "source_local") {
  //   const event = new SessionEvent("setImageSourceURI", {
  //     layer,
  //     value: get(operation, "value.uri")
  //   });
  //   session.eventManager.dispatchEvent("setImageSourceURI", event);
  // } else {
  layer.props.emit(key);
  const event = new SessionEvent("setProp", {
    layer,
    key: key,
    value: operation.value
  });
  session.eventManager.dispatchEvent("setProp", event);
  // }
}
