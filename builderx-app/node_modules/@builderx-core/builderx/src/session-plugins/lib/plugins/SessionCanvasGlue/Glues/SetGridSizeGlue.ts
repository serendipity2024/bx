import { Layer } from "@builderx-core/designer";
import { forEach } from "lodash";
import { SessionEvent } from "event-manager";
import { Session } from "session";

type GridSizeData = {
  x: number;
  y: number;
};

function applySideEffects(session: Session, gridSizeData: GridSizeData) {
  if (
    session.currentStage.canvas &&
    session.drivers.configuration.get("editor.show.grid")
  ) {
    forEach(session.currentStage.canvas.children, (artboard: Layer) => {
      artboard.executeFunction("showGrid", gridSizeData);
      session.currentStage.canvas.executeFunction(
        "setGridSize",
        artboard.executeFunction("getGridSize")
      );
    });
  }
}

export default function SetGridSizeGlue(session: Session, e: SessionEvent) {
  applySideEffects(session, e.payload.gridSizeData);
}
