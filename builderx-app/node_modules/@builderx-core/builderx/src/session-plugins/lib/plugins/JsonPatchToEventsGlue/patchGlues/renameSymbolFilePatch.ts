import { DomainLayer, DomainFile, Style } from "domain-x";
import { Session } from "session";
import { SessionEvent } from "event-manager";
import { forEach } from "lodash";

export default function renameSymbolFilePatch(
  session: Session,
  operation: any
) {
  const newPath = operation.path.split(":::")[1];
  let symbolNameMatch = newPath.match(/(([^/]*))\.js$/);
  if (symbolNameMatch && symbolNameMatch[1]) {
    const newName = symbolNameMatch[1];
    const event = new SessionEvent("renameSymbolFile", {
      file: session.domain.files.get(newPath),
      newName
    });
    session.eventManager.dispatchEvent("renameSymbolFile", event);
    session.domain.emit("files");
  }
}
