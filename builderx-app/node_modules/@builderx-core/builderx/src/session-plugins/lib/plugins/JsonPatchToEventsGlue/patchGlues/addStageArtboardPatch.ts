import { Session, StageArtboard } from "session";
import { SessionEvent } from "event-manager";
import { last } from "lodash";

export default function addStageArtboardPatch(
  session: Session,
  stageId: string,
  operation: any
) {
  let typeOfStage = operation.path.split("/")[1];
  typeOfStage = typeOfStage.slice(0, typeOfStage.indexOf("::"));
  const stages = session[typeOfStage];
  const stage = stages.get(stageId);
  const stageArtboard: StageArtboard | undefined = last(stage.stageArtboards);

  if (stageArtboard) {
    stageArtboard.setRootLayerId(operation.value.rootLayerId);
    stageArtboard.setPath(operation.value.filePath);

    session.eventManager.dispatchEvent(
      "addStageArtboard",
      new SessionEvent("addStageArtboard", {
        stageId,
        rootLayerId: operation.value.rootLayerId,
        stageArtboard,
        thumbnailStage: typeOfStage === "thumbnailStages"
      })
    );
  }
}
