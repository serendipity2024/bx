import { Session } from "session";
import { MenuItem } from "./types";

export function registerKeyMapper(
  session: Session,
  menuItemCallback: () => MenuItem | undefined
) {
  const item: MenuItem | undefined = menuItemCallback();
  if (item && item.shortcut) {
    if (session.isPluginLoaded("KeyMapperProvider")) {
      session.executeFunction(
        "KeyMapperProvider.add",
        item.shortcut,
        item.callback,
        item.caption
      );
    }
  }
  if (item && item.children && item.children.length) {
    item.children.forEach((childCallback: () => MenuItem | undefined) => {
      registerKeyMapper(session, childCallback);
    });
  }
}

export function unregisterKeyMapper(
  session: Session,
  menuItemCallback: () => MenuItem | undefined
) {
  const item: MenuItem | undefined = menuItemCallback();
  if (item && item.shortcut) {
    if (session.isPluginLoaded("KeyMapperProvider")) {
      session.executeFunction("KeyMapperProvider.remove", item.shortcut);
    }
  }
  if (item && item.children && item.children.length) {
    item.children.forEach((childCallback: () => MenuItem | undefined) => {
      unregisterKeyMapper(session, childCallback);
    });
  }
}
