import { DomainFile } from "domain-x";
import { SessionEvent } from "event-manager";
import { Session, Mutators } from "session";
import { globalRefMap } from "global-ref-map";

function applySideEffects(session: Session, domainFile: DomainFile) {
  const artboard = session.currentStage.canvas.executeFunction(
    "getArtboardById",
    domainFile.path
  );
  if (artboard) {
    artboard.executeFunction("hideGrid");
  }

  let stageId = "artboard";
  if (domainFile.isSymbol()) {
    stageId = domainFile.path;
  }

  const stageArtboard = Mutators.RemoveStageArtboardMutator(
    session,
    stageId,
    domainFile.path
  );

  globalRefMap.delete(domainFile);
}

export default function RemoveFileGlue(session: Session, e: SessionEvent) {
  applySideEffects(session, e.payload.file);
}
