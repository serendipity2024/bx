import * as React from "react";
import {
  Window,
  WindowFooter,
  WindowBody,
  Text,
  Pane,
  FormCol,
  FormRow,
  Button,
  ButtonGroup,
  Title,
  Scrollbars,
  ModalContainer,
  ModalBackdrop,
  ModalContent
} from "components-x";
import { Session } from "../../../models/Session";
import SetModalRoute from "../../../Commands/Router/SetModalRoute";
import { action } from "model";

export default class Shortcuts extends React.PureComponent<
  { session: Session },
  any
> {
  componentDidMount() {
    document.addEventListener("keyup", this._handleKeyDown);
  }
  componentWillUnmount() {
    document.removeEventListener("keyup", this._handleKeyDown);
  }
  _handleKeyDown = (event: any) => {
    const ESCAPE_KEY = 27;
    const ENTER_KEY = 13;
    switch (event.keyCode) {
      case ESCAPE_KEY:
        this.exitModal();
        break;
      case ENTER_KEY:
        this.exitModal();
        break;
      default:
        break;
    }
  };
  exitModal = () => {
    action(() => {
      this.props.session.commandManager.executeAndSkip(
        new SetModalRoute(this.props.session, "")
      );
    });
  };

  render() {
    let shortcuts = this.props.session.keyMapper.getAll();
    return (
      <ModalContainer>
        <ModalBackdrop onClick={this.exitModal} />
        <ModalContent uiSize="m" maxHeight>
          <Window
            uiSize="ms"
            onKeyPress={(e: any) => {
              if (e.keyCode === 27 || e.keyCode === 13) {
                this.exitModal();
              }
            }}
          >
            <WindowBody>
              <Pane uiBackground={800}>
                <FormRow noPadding alignTop className="p-4 bb">
                  <FormCol uiSize="xs" contentLeft alignTop>
                    <Title
                      data-cypress-id="keyboard-shortcut-title"
                      uiSize="m"
                      uiColor={300}
                    >
                      Keyboard Shortcuts
                    </Title>
                  </FormCol>
                </FormRow>
                <FormRow className="px-4">
                  <Pane
                    padder="xs"
                    uiBackground={600}
                    style={{ maxHeight: 600, lineHeight: 1.6 }}
                  >
                    <Scrollbars autoHide autoHeight>
                      {shortcuts.map((shortcut: any, i: any) => {
                        if (shortcut.value.startsWith("Testing")) {
                          return null;
                        }
                        return (
                          <FormRow
                            key={i}
                            noTopPadding={i === 0}
                            noPadding={i === shortcuts.length - 1}
                          >
                            <FormCol first>
                              <Text uiSize={"m"} paddingLeft={15}>
                                {shortcut.value}
                              </Text>
                            </FormCol>
                            <FormCol first>
                              <Text
                                uiSize={"m"}
                                paddingLeft={15}
                                style={{ fontFamily: "monospace" }}
                              >
                                {shortcut.key
                                  .split("+")
                                  .join(" ")
                                  .split("mod")
                                  .join("⌘")
                                  .split("shift")
                                  .join("⇧")
                                  .split("option")
                                  .join("⌥")}
                              </Text>
                            </FormCol>
                          </FormRow>
                        );
                      })}
                    </Scrollbars>
                  </Pane>
                </FormRow>
              </Pane>
            </WindowBody>
            <WindowFooter>
              <Pane uiBackground={800} className="p-4">
                <ButtonGroup contentRight>
                  <Button
                    data-cypress-id="keyboard-shortcut-close"
                    actionBtn
                    uiBackground={500}
                    border
                    caption="Close"
                    minWidth
                    uiSize="s"
                    onClick={this.exitModal}
                    active
                  />
                </ButtonGroup>
              </Pane>
            </WindowFooter>
          </Window>
        </ModalContent>
      </ModalContainer>
    );
  }
}
