import * as React from "react";
import {
  Window,
  WindowFooter,
  WindowBody,
  Text,
  Pane,
  FormCol,
  FormRow,
  FormGroup,
  Button,
  ButtonGroup,
  ModalContainer,
  ModalBackdrop,
  ModalContent
} from "components-x";
import { Session } from "../../../models/Session";
import SetModalRoute from "../../../Commands/Router/SetModalRoute";
import { action } from "model";

export default class MissingArtboard extends React.Component<
  { session: Session },
  any
> {
  invalidFiles = this.props.session.modalRouter.getRouteInfo();
  constructor(props: any) {
    super(props);
  }
  componentDidMount() {
    document.addEventListener("keyup", this._handleKeyDown);
  }
  componentWillUnmount() {
    document.removeEventListener("keyup", this._handleKeyDown);
  }
  _handleKeyDown = (event: any) => {
    const ESCAPE_KEY = 27;
    const ENTER_KEY = 13;
    switch (event.keyCode) {
      case ESCAPE_KEY:
        this.exitModal();
        break;
      case ENTER_KEY:
        this.exitModal();
        break;
      default:
        break;
    }
  };
  exitModal = () => {
    action(() => {
      this.props.session.commandManager.executeAndSkip(
        new SetModalRoute(this.props.session, "")
      );
    });
  };
  render() {
    return (
      <ModalContainer>
        <ModalBackdrop onClick={this.exitModal} />
        <ModalContent uiSize="m" maxHeight={true}>
          <Window
            uiSize="m"
            maxHeight={true}
            onKeyPress={(e: any) => {
              if (e.keyCode === 27 || e.keyCode === 13) {
                this.exitModal();
              }
            }}
          >
            <WindowBody maxHeight={true}>
              <Pane padder="xs" uiBackground={800}>
                <FormGroup>
                  <FormRow>
                    <FormCol first={true}>
                      <Text uiSize={"m"} bold={true}>
                        {this.invalidFiles.length < 2
                          ? "There is some error with an artboard in the sketch file you are trying to import."
                          : "There is some error with some artboards in the sketch file you are trying to import."}
                      </Text>
                    </FormCol>
                  </FormRow>
                  <FormRow>
                    <FormCol first={true}>
                      <Text uiSize={"m"}>
                        {this.invalidFiles.length < 2
                          ? "This artboard could not be imported"
                          : "These artboards could not be imported"}
                      </Text>
                    </FormCol>
                  </FormRow>
                  <FormRow>
                    <Pane padder="xs" uiBackground={600} scrollable>
                      {this.invalidFiles.map((missingFile: any, i: any) => {
                        return (
                          <FormRow
                            key={i}
                            noTopPadding={i === 0}
                            noPadding={i === this.invalidFiles.length - 1}
                          >
                            <FormCol first={true}>
                              <Text uiSize={"m"}>{missingFile}</Text>
                            </FormCol>
                          </FormRow>
                        );
                      })}
                    </Pane>
                  </FormRow>
                </FormGroup>
              </Pane>
            </WindowBody>
            <WindowFooter>
              <Pane padder="xs" uiBackground={800}>
                <ButtonGroup contentRight={true}>
                  <Button
                    actionBtn={true}
                    uiBackground={500}
                    border={true}
                    caption="Ok"
                    minWidth={true}
                    uiSize="s"
                    onClick={this.exitModal}
                    marginRight={true}
                    active
                  />
                </ButtonGroup>
              </Pane>
            </WindowFooter>
          </Window>
        </ModalContent>
      </ModalContainer>
    );
  }
}
