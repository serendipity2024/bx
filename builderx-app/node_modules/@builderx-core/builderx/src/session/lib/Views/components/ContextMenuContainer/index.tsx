import * as React from "react";
import { MainMenu, contextMenu } from "builderx-module-context-menu";
import { Session } from "../../../models/Session";

class ContextMenuContainer extends React.PureComponent<
  { session: Session },
  any
> {
  eventData: any;
  onUpdate = () => {
    this.forceUpdate();
  };
  registerData = (event: any) => {
    if (event.payload && event.payload.originalEvent) {
      this.eventData = event.payload;
      this.onUpdate();
      event.payload.originalEvent.preventDefault();
      contextMenu.show({
        id: `menuId`,
        event: event.payload.originalEvent
      });
    }
  };
  componentDidMount() {
    this.props.session.eventManager.addEventListener(
      "contextmenu",
      this.registerData
    );
  }
  componentWillUnmount() {
    this.props.session.eventManager.removeEventListener(
      "contextmenu",
      this.registerData
    );
  }

  render() {
    if (!this.eventData) {
      return null;
    }
    return (
      <MainMenu
        menuId={"menuId"}
        data={this.props.session.drivers.contextMenu(this.eventData)}
      />
    );
  }
}

export default ContextMenuContainer;
