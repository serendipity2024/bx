import * as React from "react";
import { Session } from "../../../../models/Session";
import {
  Text,
  Title,
  FormGroup,
  FormCol,
  FormRow,
  InputGroupInput,
  ButtonGroup,
  Button,
  Section,
  SectionFooter,
  SectionBody,
  Form,
  Checkbox,
  CheckboxLabel,
  CheckboxTick
} from "components-x";
import SetConfig from "./../../../../Commands/Workspace/SetConfig";
import SetModalRoute from "./../../../../Commands/Router/SetModalRoute";
import { action } from "model";
type propType = {
  session: Session;
};

export default class Editor extends React.Component<propType, any> {
  constructor(props: propType) {
    super(props);
    const configuration = this.props.session.drivers.configuration;
    this.state = {
      isInInt: configuration.get("editor.style.value.int"),
      arrowShiftVal: configuration.get("editor.shift.layer.arrow.value"),
      cmdArrowShiftVal: configuration.get("editor.shift.layer.cmd.arrow.value")
    };
  }
  componentDidMount() {
    document.addEventListener("keyup", this._handleKeyDown);
  }
  componentWillUnmount() {
    document.removeEventListener("keyup", this._handleKeyDown);
  }
  _handleKeyDown = (event: any) => {
    const ESCAPE_KEY = 27;
    const ENTER_KEY = 13;
    switch (event.keyCode) {
      case ESCAPE_KEY:
        this.exitModal();
        break;
      case ENTER_KEY:
        this.onSubmit(event);
        break;
      default:
        break;
    }
  };
  exitModal = () => {
    action(() => {
      this.props.session.commandManager.executeAndSkip(
        new SetModalRoute(this.props.session, "")
      );
    });
  };
  isInvalid() {
    if (!this.state.arrowShiftVal || !this.state.cmdArrowShiftVal) {
      return true;
    }
    return false;
  }
  handleChange = (e: any, property: string) => {
    if (e.target) {
      this.setState({ [property]: e.target.value });
    }
  };
  handleCheck = (e: any, property: any) => {
    if (e.target) {
      this.setState({ [property]: e.target.checked });
    }
  };
  onSubmit = (e: any) => {
    action(() => {
      e.preventDefault();
      let session = this.props.session;
      if (this.isInvalid()) {
        return;
      }
      session.commandManager.executeAndSkip(
        new SetConfig(session, "editor.style.value.int", this.state.isInInt)
      );
      session.commandManager.executeAndSkip(
        new SetConfig(
          session,
          "editor.shift.layer.arrow.value",
          this.state.arrowShiftVal
        )
      );
      session.commandManager.executeAndSkip(
        new SetConfig(
          session,
          "editor.shift.layer.cmd.arrow.value",
          this.state.cmdArrowShiftVal
        )
      );
      session.commandManager.executeAndSkip(new SetModalRoute(session, ""));
    });
  };
  keyPress = (e: any) => {
    if (e.charCode === 13) {
      this.onSubmit(e);
    }
  };
  render() {
    return (
      <Section>
        <Form onKeyPress={(e: any) => this.keyPress(e)}>
          <SectionBody marginBottom={70}>
            <FormGroup className="p-0">
              <FormRow className="p-4 bb">
                <FormCol uiSize="m" contentLeft className="px-0">
                  <Title uiSize={"m"} uiColor={300}>
                    Editor
                  </Title>
                </FormCol>
              </FormRow>
              <FormGroup className="px-4 py-2 bb">
                <FormRow className="py-2">
                  <FormCol first uiSize={6}>
                    <Text uiSize={"m"}>Arrow key shifts layer by</Text>
                  </FormCol>
                  <FormCol>
                    <InputGroupInput
                      undo={this.props.session.commandManager.undo}
                      redo={this.props.session.commandManager.redo}
                      type="number"
                      uiSize="l"
                      autoFocus={true}
                      value={this.state.arrowShiftVal}
                      onChange={(e: any) =>
                        this.handleChange(e, "arrowShiftVal")
                      }
                    />
                  </FormCol>
                  <FormCol>
                    <Text uiSize={"m"}>pt</Text>
                  </FormCol>
                </FormRow>
                <FormRow className="py-2">
                  <FormCol first uiSize={6}>
                    <Text uiSize={"m"}>Shift + arrow key shifts layer by</Text>
                  </FormCol>
                  <FormCol>
                    <InputGroupInput
                      type="number"
                      uiSize="l"
                      value={this.state.cmdArrowShiftVal}
                      onChange={(e: any) =>
                        this.handleChange(e, "cmdArrowShiftVal")
                      }
                    />
                  </FormCol>
                  <FormCol>
                    <Text uiSize={"m"}>pt</Text>
                  </FormCol>
                </FormRow>
                <FormRow className="py-2">
                  <Checkbox>
                    <CheckboxTick
                      noMargin
                      checked={this.state.isInInt}
                      onClick={(e: any) => this.handleCheck(e, "isInInt")}
                      onChange={() => {
                        //
                      }}
                    />
                    <CheckboxLabel uiSize={"l"}>
                      Use integer value for orientation properties
                    </CheckboxLabel>
                  </Checkbox>
                </FormRow>
                {this.isInvalid() && (
                  <FormRow>
                    <FormCol first>
                      <Text>Fields cannot be empty}</Text>
                    </FormCol>
                  </FormRow>
                )}
              </FormGroup>
            </FormGroup>
          </SectionBody>
          <SectionFooter padder="s">
            <ButtonGroup uiSize="xl" contentRight={true}>
              <Button
                actionBtn={true}
                uiBackground={500}
                border
                minWidth
                caption="OK"
                uiSize="s"
                onClick={(e: any) => this.onSubmit(e)}
                active
              />
            </ButtonGroup>
          </SectionFooter>
        </Form>
      </Section>
    );
  }
}
