import { GlobalStyle, Screen, ScreenBody, ScreenSection } from "components-x";
import { DialogX } from "dialog-x";
import * as React from "react";
import { ToastContainer } from "react-toastify";

import { Session } from "../models/Session";
import { CloseButton } from "../services/NotificationManager/notificationBody";
import ModalRouter from "./Modals/Router";
import PageRouter from "./Pages/Router";
import ExternalComponentsRenderer from "./components/ExternalComponentsRenderer";

// @ts-ignore
import("builderx-module-context-menu/build/static/css/style.css");
type propType = {
  session: Session;
  sharedComponentSession: Session;
};

export default class Views extends React.PureComponent<propType, any> {
  componentDidMount() {
    this.props.session.modalRouter.on("currentRoute", this.onUpdate);
  }
  componentWillUnmount() {
    this.props.session.modalRouter.off("currentRoute", this.onUpdate);
  }
  onUpdate = () => {
    this.forceUpdate();
  };
  render() {
    let { session, sharedComponentSession } = this.props;

    return (
      <Screen>
        <GlobalStyle />
        <ToastContainer closeButton={<CloseButton />} />
        <div
          style={{
            position: "absolute",
            zIndex: 1,
            pointerEvents: "none",
            height: "100%",
            width: "100%"
          }}
        >
          <ExternalComponentsRenderer
            session={session}
            placement="overlay"
            style={{ pointerEvents: "auto" }}
          />
        </div>
        <ScreenBody>
          <ScreenSection>
            <PageRouter
              session={session}
              sharedComponentSession={sharedComponentSession}
            />
          </ScreenSection>
          <ScreenSection>
            <ModalRouter session={session} />
          </ScreenSection>
        </ScreenBody>
      </Screen>
    );
  }
}
