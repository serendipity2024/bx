import { Session } from "../models/Session";
import { SetFileDirtyMutator } from ".";
import { SessionEvent } from "event-manager";
import { Utils } from "utils";

export default function RemoveStyleAttributeMutator(
  session: Session,
  layerId: string,
  key: string,
  stylePropName: any = "style"
) {
  const file = session.getFileFromLayerPath(layerId);

  if (!file) {
    return;
  }

  // let scopeVariables = {};

  // if (file) {
  //   scopeVariables = this.file.scopeVariables;
  // }

  const layer = file.getLayerFromPath(layerId);
  if (!layer) {
    return;
  }

  if (layer.type === "literal") {
    return;
  }

  session.emitPatch({
    op: "remove",
    path: `/domain/files:::${Utils.modifyLayerPathForJsonPatch(
      layerId
    )}/props/${stylePropName}/${key}`
  });

  // layer.props.removeStyleAttribute(key, stylePropName);

  // if (session.currentStage.dragging) {
  //   layer.emit("onDragLayer");
  // } else {
  //   layer.props.style.emit(key);
  // }
  SetFileDirtyMutator(session, file.path, true);

  // if (removeCenterWrapper) {
  //   SetCenterWrapperMutator(session, layerId, {
  //     horizontal: false,
  //     vertical: false
  //   });
  // }

  // const event = new SessionEvent("removeStyleAttribute", {
  //   layer: layer,
  //   key,
  //   stylePropName
  // });

  // session.eventManager.dispatchEvent("removeStyleAttribute", event);

  return layer;
}
