import { Session } from "../models/Session";
import { forEach } from "lodash";
import { Layer } from "domain-x";
import SelectLayersMutator from "./SelectLayersMutator";
import { SessionEvent } from "event-manager";
import { Utils } from "utils";

// TODO: Do we really need this mutator?

export default function DeselectAllLayersMutator(
  session: Session,
  generatePreview: boolean = false
) {
  forEach(session.getLayersFromSelectedLayerCollection(), (layer: Layer) => {
    const layerPath = layer.getFullPath();
    if (layerPath) {
      session.emitPatch({
        op: "replace",
        path: `/domain/files:::${Utils.modifyLayerPathForJsonPatch(
          layerPath
        )}/selected`,
        value: false
      });
    }
  });

  session.emitPatch({
    op: "replace",
    path: `/selectedLayers`,
    value: []
  });
  session.emitPatch({
    op: "replace",
    path: `/selectedNodes`,
    value: []
  });

  if (session.selectedFile) {
    SelectLayersMutator(session, [], generatePreview);
  }
}
