export const BX_PREVIEW_FILE_PATH = "src/preview/Index.js";

import { Session } from "../models/Session";
import { File as DomainFile } from "domain-x";
import { SetFileDirtyMutator, SetAllScopeVariablesMutator } from ".";
import { SessionEvent } from "event-manager";

export default function AddFileMutator(
  session: Session,
  filePath: any,
  version: any,
  dbFileId: any
) {
  // const file = new DomainFile({ path: filePath, version, dbFileId }, session);
  // session.domain.files.set(file.path, file);
  const file: DomainFile = session.emitPatch({
    op: "add",
    path: `/domain/files:::${filePath}`,
    value: {
      type: "class",
      className: "DomainFile",
      value: { path: filePath, version, dbFileId, type: "file" }
    }
  });
  SetAllScopeVariablesMutator(session, filePath, {});
  SetFileDirtyMutator(session, filePath, true);
  // const event = new SessionEvent("addFile", {
  //   filePath
  // });
  // session.eventManager.dispatchEvent("addFile", event);
  // session.domain.emit("files");
  return file;
}
