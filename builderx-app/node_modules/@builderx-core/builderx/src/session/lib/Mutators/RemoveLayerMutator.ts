import { IMutator } from "common-interfaces";
import { Session } from "../models/Session";
import { forEach } from "lodash";
import { Layer as DomainLayer } from "domain-x";
import CommandUtils from "../Commands/Utils";
import { SetFileDirtyMutator } from ".";
import { Layer } from "@builderx-core/designer";
import { SessionEvent } from "event-manager";
import { Utils } from "utils";

export default function RemoveLayerMutator(session: Session, layerId: string) {
  const domainLayer = session.getLayerFromLayerPath(layerId);
  const file = session.getFileFromLayerPath(layerId);
  if (!domainLayer || !file) {
    return;
  }
  session.emitPatch({
    op: "remove",
    path: `/domain/files:::${Utils.modifyLayerPathForJsonPatch(layerId)}`
  });

  SetFileDirtyMutator(session, file.path, true);

  return domainLayer;
}
