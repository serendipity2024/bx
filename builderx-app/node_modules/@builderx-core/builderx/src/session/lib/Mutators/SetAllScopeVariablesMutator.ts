import { Session } from "../models/Session";
import { forEach } from "lodash";
import { SessionEvent } from "event-manager";
import { Utils } from "utils";

export default function SetAllScopeVariablesMutator(
  session: Session,
  layerPath: string,
  variableObj: any
) {
  const layer = session.getLayerFromLayerPath(layerPath);
  if (layer) {
    // forEach(variableObj, (value: any, key: string) => {
    //   // file.scopeVariables[key] = value;

    //   session.applyPatch({
    //     op: "replace",
    //     path: `/domain/files:::${file.path}:::/scopeVariables/key`,
    //     value: value
    //   });
    // });

    session.emitPatch({
      op: "replace",
      path: `/domain/files:::${Utils.modifyLayerPathForJsonPatch(
        layerPath
      )}/scopeVariables`,
      value: { ...layer.scopeVariables, ...variableObj }
    });

    // const event = new SessionEvent("updateFileScopeVariables", {
    //   file,
    //   variableObj
    // });

    // session.eventManager.dispatchEvent("updateFileScopeVariables", event);
    // file.emit("scopeVariables");
  }
}
