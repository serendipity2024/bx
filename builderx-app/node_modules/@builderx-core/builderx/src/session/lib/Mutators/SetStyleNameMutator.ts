import { Session } from "../models/Session";
import { SetFileDirtyMutator } from ".";
import { SessionEvent } from "event-manager";
import { Utils } from "utils";

export default function SetStyleNameMutator(
  session: Session,
  layerPath: string,
  styleName: string,
  autoRename: boolean
) {
  const file = session.getFileFromLayerPath(layerPath);
  if (!file) {
    return;
  }

  const layer = session.getLayerFromLayerPath(layerPath);
  if (!layer) {
    return;
  }

  if (layer.type === "text" && layer.autoRenaming) {
    // layer.autoRenaming = autoRename;

    session.emitPatch({
      op: "replace",
      path: `/domain/files:::${Utils.modifyLayerPathForJsonPatch(
        layerPath
      )}/autoRenaming`,
      value: autoRename
    });
  }

  session.emitPatch({
    op: "replace",
    path: `/domain/files:::${Utils.modifyLayerPathForJsonPatch(
      layerPath
    )}/styleName`,
    value: Utils.getValidLayerName(styleName)
  });

  // layer.emit("styleName");

  SetFileDirtyMutator(session, file.path, true);
}
