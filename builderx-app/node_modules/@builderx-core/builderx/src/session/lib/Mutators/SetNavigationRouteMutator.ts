import { IMutator } from "common-interfaces";
import { Session } from "../models/Session";
import { Layer as CanvasLayer } from "@builderx-core/designer";
import { forEach } from "lodash";
import { SetFileDirtyMutator } from ".";
import { SessionEvent } from "event-manager";
import { Utils } from "utils";

export default function SetNavigationRouteMutator(
  session: Session,
  layerId: string,
  navigateTo: string
) {
  const layer = session.getLayerFromLayerPath(layerId);
  if (!layer) {
    return;
  }
  // layer.setNavigationRoute(navigateTo);
  session.emitPatch({
    op: "replace",
    path: `/domain/files:::${Utils.modifyLayerPathForJsonPatch(
      layerId
    )}/navigateTo`,
    value: navigateTo
  });

  // layer.emit("navigateTo");

  const file = layer.getFile();
  if (file) {
    SetFileDirtyMutator(session, file.path, true);
  }
}
