import { Layer } from "domain-x";
import { isNil } from "lodash";
import { Session } from "../../models/Session";
import createService from ".";

export const AddSymbolInstRefInSymbolFile = createService(
  "AddSymbolInstRefInSymbolFile",
  (session: Session, domainLayer: Layer) => {
    try {
      if (domainLayer.type === "symbol") {
        const symbolFile = session.domain.getSymbolFileFromSymbolInstance(
          domainLayer
        );
        if (!symbolFile) {
          return;
        }
        const index = symbolFile.symbolInstances.indexOf(domainLayer);
        if (isNil(index) || index === -1) {
          symbolFile.symbolInstances.push(domainLayer);
        }
      }
    } catch (err) {
      console.log(err, "Could't add symbol layer ref in symbol file");
    }
  }
);
