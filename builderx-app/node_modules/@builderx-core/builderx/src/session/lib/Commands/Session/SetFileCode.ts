import { ICommand } from "command-manager";
import { Session } from "../../models/Session";
import { BX_PREVIEW_FILE_PATH } from "bx-constants";

export default class SetFileCode implements ICommand {
  displayName = "SetFileCode";
  session: Session;
  constructor(session: Session) {
    this.session = session;
  }
  execute() {
    if (this.session.shouldUpdateCode) {
      const file = this.getFile();

      if (file) {
        this.session.getFileCode(file).then((code: string) => {
          this.session.setCurrentFileCode(code);
        });
      }
    }
  }
  getFile() {
    const showPreviewLayerCode =
      this.session.getLayersFromSelectedLayerCollection().length > 0 &&
      this.session.getLayersFromSelectedLayerCollection()[0].type !== "root";

    if (showPreviewLayerCode) {
      const file = this.session.domain.files.get(BX_PREVIEW_FILE_PATH);
      if (file) {
        return file;
      }
    }
    return this.session.selectedFile;
  }
  undo() {
    //
  }
  redo() {
    //
  }
}
