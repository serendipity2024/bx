import { Session } from "../../models/Session";
import createService from ".";

export const UploadImage = createService(
  "UploadImage",
  (
    session: Session,
    imageName: string,
    imagebase64: string
  ): Promise<string | undefined> => {
    return new Promise(async (resolve, reject) => {
      try {
        if (imageName) {
          let assetsImagePath = "";

          // for spaces in image name
          if (imageName.includes(" ")) {
            imageName = imageName.replace(/ /g, "_");
          }
          if (imageName.length > 0) {
            assetsImagePath = `${session.project.defaultAssetDirectory}/${imageName}`;
            // upload image
            session.before();
            // await session.apiSdk.assets.uploadAsset(
            //   session.project.projectId,
            //   assetsImagePath,
            //   imagebase64,
            //   session.connectionId,
            //   "image"
            // );
            resolve(assetsImagePath);
          }
        }
      } catch (error) {
        console.error("Couldn't upload image", error);
        resolve(undefined);
      } finally {
        session.after();
      }
    });
  }
);
