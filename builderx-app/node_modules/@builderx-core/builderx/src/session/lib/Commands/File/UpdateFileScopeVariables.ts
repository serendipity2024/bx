import { ICommand } from "command-manager";
import { Session } from "../../models/Session";
import { File } from "domain-x";
import { SetAllScopeVariablesService } from "../CommandServices/SetAllScopeVariablesService";
export default class UpdateFileScopeVariables implements ICommand {
  displayName = "UpdateFileScopeVariables";
  private session: Session;
  private variableObj: { [key: string]: any };
  private filePath?: string;
  private oldScopeVariables: { [key: string]: any };
  constructor(
    session: Session,
    variableObj: { [key: string]: any },
    file?: File,
    settingOverride: boolean = false
  ) {
    this.session = session;
    this.variableObj = variableObj;
    this.filePath = file ? file.path : undefined;
  }
  execute() {
    let file;
    if (this.filePath) {
      file = this.session.domain.files.get(this.filePath);
    }
    if (file) {
      this.oldScopeVariables = file.scopeVariables;
    }
    SetAllScopeVariablesService(this.session, this.filePath, this.variableObj);
  }

  undo() {
    SetAllScopeVariablesService(
      this.session,
      this.filePath,
      this.oldScopeVariables
    );
  }
  redo() {
    SetAllScopeVariablesService(this.session, this.filePath, this.variableObj);
  }
}
