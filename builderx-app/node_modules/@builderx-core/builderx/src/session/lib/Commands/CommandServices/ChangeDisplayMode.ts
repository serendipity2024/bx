import { Session } from "../../models/Session";
import previewFile from "../CommandServices/PreviewFile";
import { DisplayMode } from "../../../../common-interfaces";
import { PlaceArtboardsToCenter } from "..";
import createService from ".";
import ChangeDisplayModeMutator from "../../Mutators/ChangeDisplayMode";
import { SetGridVisibilityMutator } from "../../Mutators";

const ChangeDisplayMode = createService(
  "ChangeDisplayMode",
  (session: Session, mode: DisplayMode) => {
    session.displayMode = mode;

    ChangeDisplayModeMutator(session, mode);
    if (mode === "preview") {
      if (session.selectedFile.isArtboard()) {
        previewFile(session, session.selectedFile);
      }
    }
    if (mode === "stage") {
      // TODO: no need to be touched @Suraj
      session.commandManager.executeAndSkip(
        new PlaceArtboardsToCenter(session, false)
      );
    }

    if (mode === "grid") {
      // session.currentStage.renderCompiled.children.forEach((child: any) => {
      //   // child.traverseLayers((childLayer: RenderCompiledLayer) => {
      //   child.setVisible(true);
      //   // });
      // });
      // session.currentStage.renderCompiled.emit("children");
      // session.domain.emit("files");
    }
  }
);

export default ChangeDisplayMode;
