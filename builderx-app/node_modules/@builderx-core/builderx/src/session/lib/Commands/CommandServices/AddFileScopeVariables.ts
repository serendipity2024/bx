import { DeviceStore } from "bx-constants";
import { Session } from "session";
import { merge } from "lodash";
import createService from ".";
import { SetAllScopeVariablesService } from "./SetAllScopeVariablesService";

export const AddFileScopeVariables = createService(
  "AddFileScopeVariables",
  (session: Session, fileJSON: any) => {
    const project = session.project;
    let obj = {
      deviceName: project.deviceName,
      deviceOrientation: project.deviceOrientation
    };
    obj = merge(obj, fileJSON.scopeVariables);
    const currentDevice = DeviceStore.getDeviceByName(obj.deviceName);
    if (currentDevice) {
      obj["platform"] = currentDevice.os;
    }
    SetAllScopeVariablesService(session, fileJSON.path, obj);
  }
);
