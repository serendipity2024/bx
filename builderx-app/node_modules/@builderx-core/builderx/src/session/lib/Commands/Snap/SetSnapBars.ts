import { ICommand } from "command-manager";
import { Session } from "../../models/Session";
import {
  SetVerticalSnapBar,
  RemoveVerticalSnapBar,
  SetHorizontalSnapBar,
  RemoveHorizontalSnapBar
} from "..";

export default class SetSnapBars implements ICommand {
  displayName = "SetSnapBars";
  session: Session;
  snappedData: any;
  constructor(session: Session, snappedData: any) {
    this.session = session;
    this.snappedData = snappedData;
  }
  execute() {
    if (!this.snappedData) {
      this.session.commandManager.executeAndSkip(
        new RemoveVerticalSnapBar(this.session)
      );
      this.session.commandManager.executeAndSkip(
        new RemoveHorizontalSnapBar(this.session)
      );
      return;
    }

    let zoom = this.session.currentStage.tools.zoom;
    if (
      (this.snappedData.snappedPoint.x &&
        this.snappedData.snappedPoint.x.snapLines) ||
      (this.snappedData.snappedPoint.y &&
        this.snappedData.snappedPoint.y.snapLines)
    ) {
      this.session.commandManager.executeAndSkip(
        new RemoveVerticalSnapBar(this.session)
      );
      this.session.commandManager.executeAndSkip(
        new RemoveHorizontalSnapBar(this.session)
      );
      return;
    }
    var snapBarPoint = {
      x: this.snappedData.snappedPoint.x
        ? this.snappedData.snappedPoint.x.rootValue
        : 0,
      y: this.snappedData.snappedPoint.y
        ? this.snappedData.snappedPoint.y.rootValue
        : 0
    };

    if (snapBarPoint.x) {
      var snapBarXData = {
        x: this.snappedData.snappedPoint.x.rootValue,
        y: 0,
        width: 1,
        height: 1500
      };

      this.session.commandManager.executeAndSkip(
        new SetVerticalSnapBar(this.session, snapBarXData.x * zoom)
      );
    } else {
      this.session.commandManager.executeAndSkip(
        new RemoveVerticalSnapBar(this.session)
      );
    }
    if (snapBarPoint.y) {
      var snapBarYData = {
        x: 0,
        y: this.snappedData.snappedPoint.y.rootValue,
        width: 1500,
        height: 1
      };
      this.session.commandManager.executeAndSkip(
        new SetHorizontalSnapBar(this.session, snapBarYData.y * zoom)
      );
    } else {
      this.session.commandManager.executeAndSkip(
        new RemoveHorizontalSnapBar(this.session)
      );
    }
  }
  undo() {
    //
  }
  redo() {
    //
  }
}
