/// <reference types="Cypress" />

import { getOffsetsOf, getFileBlob } from "./actions/sharedFuncs";

const { expect } = require("chai").use(require("chai-style"));

const BasicSketchFileName = "CypressTest.sketch";
const SketchWithTree = "CypressTest2.sketch";
export default function sketchImportTests() {
  context("Very Basic Sketch Test", () => {
    beforeEach(function() {
      Cypress.Cookies.preserveOnce("access-token");
    });

    it("can import sketch file", function() {
      cy.document().trigger("dragenter");
      cy.dropFile(BasicSketchFileName);
      cy.get(".modalContentX .windowFooterX button")
        .contains(/^import$/i)
        .click();
    });

    it("will verify the presencr of new artboard of iphone8 ", function() {
      cy.get(".bx-artboard-IPhone8").should("exist");
    });
    it("will verify rectangle present in artboard", function() {
      cy.get(".bx-artboard-IPhone8 > .view-render > .view-render").should(
        "exist"
      );
    });
    it("will verify ellipse present in artboard", function() {
      cy.get(".bx-artboard-IPhone8 > .view-render svg").should("exist");
    });
    it("will verify textbox present in artboard", function() {
      cy.get(".bx-artboard-IPhone8 > .view-render .text-here")
        .contains(/^Type something$/)
        .should("exist");
    });

    it("will verify image present in artboard", function() {
      cy.get(".bx-artboard-IPhone8 > .view-render div img").should("exist");
    });
  });

  context("Tests of Sketch with tree", () => {
    beforeEach(function() {
      Cypress.Cookies.preserveOnce("access-token");
    });

    it("can import sketch file", function() {
      cy.document().trigger("dragenter");
      cy.dropFile(SketchWithTree);
      cy.get(".modalContentX .windowFooterX button")
        .contains(/^import$/i)
        .click();
    });

    it("will verify the presence of new artboard2 of iphone8 ", function() {
      cy.get(".bx-artboard-IPhone9").should("exist");
    });

    it("will verify rectangle with ellipse presence", function() {
      cy.get(".bx-artboard-IPhone9 > .view-render > .view-render")
        .first()
        .should("exist")
        .should(
          "have.attr",
          "style",
          "height: 19.94%; left: 30.67%; top: 34.78%; width: 38.67%;"
        );
      cy.get(
        ".bx-artboard-IPhone9 > .view-render > .view-render > .view-render"
      )
        .first()
        .should("exist")
        .should(
          "have.attr",
          "style",
          "background-color: rgb(216, 216, 216); height: 100%; left: 0%; top: 0%; width: 100%;"
        );

      cy.get(
        ".bx-artboard-IPhone9 > .view-render > .view-render > .view-render > svg"
      )
        .first()
        .should("exist")
        .should(
          "have.attr",
          "style",
          "top: 15.41%; left: -24.48%; width: 153.1%; height: 57.89%; background-color: transparent; position: absolute; border-color: transparent; transform: rotate(0deg);"
        );
    });

    it("will verify rectangle with gradient present in artboard", function() {
      cy.get(".bx-artboard-IPhone9 > .view-render > .view-render")
        .first()
        .next()
        .should("exist")
        .should(
          "have.attr",
          "style",
          "background-image: linear-gradient(90deg, rgb(204, 51, 51) 0%, rgb(216, 216, 216) 100%); border-color: rgb(151, 151, 151); border-width: 1px; height: 12.44%; left: 16.27%; top: 6.3%; width: 74.93%;"
        );
    });

    it("will verify text in artboard", function() {
      cy.get(".bx-artboard-IPhone9 > .view-render > .text-here")
        .contains("Cypress Testing")
        .should("exist")
        .should(
          "have.attr",
          "style",
          "-webkit-font-smoothing: antialiased; color: rgb(27, 36, 145); font-size: 20px; font-weight: normal; height: 7.35%; left: 22.4%; letter-spacing: 15.3846px; text-align: center; top: 24.29%; width: 60.8%;"
        );
    });

    it("will verify tree in artboard", function() {
      cy.get(".bx-artboard-IPhone9 > .view-render > .view-render")
        .first()
        .next()
        .next()
        .next()
        .should("exist")
        .should(
          "have.attr",
          "style",
          "height: 34.03%; left: 22.93%; top: 64.32%; width: 44.53%;"
        );

      cy.get(".bx-artboard-IPhone9 > .view-render > .view-render")
        .first()
        .next()
        .next()
        .next()
        .find("svg")
        .first()
        .should(
          "have.attr",
          "style",
          "top: 10.35%; left: -0.3%; width: 101.2%; height: 55.51%; background-color: transparent; position: absolute; border-color: transparent; transform: rotate(0deg);"
        );

      cy.get(".bx-artboard-IPhone9 > .view-render > .view-render")
        .first()
        .next()
        .next()
        .next()
        .find(".view-render")
        .should(
          "have.attr",
          "style",
          "background-color: rgb(75, 16, 16); border-color: rgb(151, 151, 151); border-width: 1px; height: 34.8%; left: 40.72%; top: 65.2%; width: 19.16%;"
        );
      cy.get(".bx-artboard-IPhone9 > .view-render > .view-render")
        .first()
        .next()
        .next()
        .next()
        .find(".view-render")
        .next()
        .should(
          "have.attr",
          "style",
          "top: -0.22%; left: 8.08%; width: 88.02%; height: 22.47%; background-color: transparent; position: absolute; border-color: transparent; transform: rotate(0deg);"
        );
    });

    // it("will verify textbox present in artboard", function () {
    //     cy.get(".bx-artboard-IPhone8 .view-render .text-here")
    //         .contains(/^Type something$/)
    //         .should("exist");
    // });

    // it("will verify image present in artboard", function () {
    //     cy.get(".bx-artboard-IPhone8 .view-render div img").should("exist");
    // });
  });
}
